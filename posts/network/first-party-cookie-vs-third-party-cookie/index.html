<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>퍼스트 파티 쿠키와 서드 파티 쿠키 | 5hdumat</title>
<meta name=keywords content="Network,Http,Cookie,SameSite,CSRF">
<meta name=description content="쿠키에 대한 Domain 설정 쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.
 Set-Cookie: normal=yes; Domain=localhost  이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 normal 쿠키는 localhost를 대상으로 쿠키가 설정되었기 때문에, localhost를 대상으로 한 요청에만 normal쿠키가 전송 된다.
쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.
퍼스트 파티 쿠키와 서드 파티 쿠키 이렇게 설정된 도메인을 기준으로 퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies) 로 나눌 수 있다.">
<meta name=author content="서민규">
<link rel=canonical href=https://5hdumat.github.io/posts/network/first-party-cookie-vs-third-party-cookie/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.6cba0d81b5f3f42bb578d49f402ba4175aa72b43def148780b8ad714c957c6f5.css integrity="sha256-bLoNgbXz9Cu1eNSfQCukF1qnK0Pe8Uh4C4rXFMlXxvU=" rel="preload stylesheet" as=style>
<link rel=preload href=/resources/images/profile/giphy.gif as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://5hdumat.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://5hdumat.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://5hdumat.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://5hdumat.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://5hdumat.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.87.0">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-05YE8R0TGZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-05YE8R0TGZ',{anonymize_ip:!1})}</script>
<meta property="og:title" content="퍼스트 파티 쿠키와 서드 파티 쿠키">
<meta property="og:description" content="쿠키에 대한 Domain 설정 쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.
 Set-Cookie: normal=yes; Domain=localhost  이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 normal 쿠키는 localhost를 대상으로 쿠키가 설정되었기 때문에, localhost를 대상으로 한 요청에만 normal쿠키가 전송 된다.
쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.
퍼스트 파티 쿠키와 서드 파티 쿠키 이렇게 설정된 도메인을 기준으로 퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies) 로 나눌 수 있다.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://5hdumat.github.io/posts/network/first-party-cookie-vs-third-party-cookie/">
<meta property="og:image" content="https://5hdumat.github.io/resources/images/network/cookies.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-26T22:36:50+09:00">
<meta property="article:modified_time" content="2021-08-26T22:36:50+09:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://5hdumat.github.io/resources/images/network/cookies.jpg">
<meta name=twitter:title content="퍼스트 파티 쿠키와 서드 파티 쿠키">
<meta name=twitter:description content="쿠키에 대한 Domain 설정 쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.
 Set-Cookie: normal=yes; Domain=localhost  이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 normal 쿠키는 localhost를 대상으로 쿠키가 설정되었기 때문에, localhost를 대상으로 한 요청에만 normal쿠키가 전송 된다.
쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.
퍼스트 파티 쿠키와 서드 파티 쿠키 이렇게 설정된 도메인을 기준으로 퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies) 로 나눌 수 있다.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://5hdumat.github.io/posts/"},{"@type":"ListItem","position":3,"name":"퍼스트 파티 쿠키와 서드 파티 쿠키","item":"https://5hdumat.github.io/posts/network/first-party-cookie-vs-third-party-cookie/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"퍼스트 파티 쿠키와 서드 파티 쿠키","name":"퍼스트 파티 쿠키와 서드 파티 쿠키","description":"쿠키에 대한 Domain 설정 쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.\n Set-Cookie: normal=yes; Domain=localhost  이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 normal 쿠키는 localhost를 대상으로 쿠키가 설정되었기 때문에, localhost를 대상으로 한 요청에만 normal쿠키가 전송 된다.\n쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.\n퍼스트 파티 쿠키와 서드 파티 쿠키 이렇게 설정된 도메인을 기준으로 퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies) 로 나눌 수 있다.","keywords":["Network","Http","Cookie","SameSite","CSRF"],"articleBody":"쿠키에 대한 Domain 설정 쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.\n Set-Cookie: normal=yes; Domain=localhost  이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 normal 쿠키는 localhost를 대상으로 쿠키가 설정되었기 때문에, localhost를 대상으로 한 요청에만 normal쿠키가 전송 된다.\n쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.\n퍼스트 파티 쿠키와 서드 파티 쿠키 이렇게 설정된 도메인을 기준으로 퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies) 로 나눌 수 있다.\n아래 예시를 살펴보자.\n 클라이언트가 site1.com에 접속한다. site1.com에 접속한 클라이언트가 image-site.com에서 제공하는 이미지 리소스를 사용하려고 한다.  이 경우 클라이언트는 site1.com에 접속해 있지만 image-site.com/image.png로 이미지 리소스에 대한 요청을 보내게 된다. 아래와 같은 HTML 코드로 나타낼 수 있겠다.\nhtml head titleseob.devtitle meta property=\"og:url\" content=\"https://site1.com/\" / head body img src=\"https://image-site.com/image.png\" / body html 이 때 클라이언트의 쿠키 저장소에 image-site.com 도메인에 대한 쿠키 정보가 조회된다면 브라우저는 요청 헤더에 쿠키 정보를 같이 넘길 것이다. 이렇게 전송되는 쿠키를 서드 파티 쿠키라고 한다. 즉, 사용자가 접속한 도메인과 다른 도메인으로 전송하는 쿠키를 의미한다. (Referer 헤더와 쿠키에 설정된 도메인이 다른 케이스)\n퍼스트 파티 쿠키는 반대로 클라이언트가 접속한 페이지와 같은 도메인으로 전송되는 쿠키를 의미한다.\n쿠키와 CSRF 쿠키의 제약조건 중 보안에서 CSRF를 엄청 간단하게 다뤘지만 좀 더 짚고 넘어가보자.\nCSRF Cross-Stie Request Forgery의 준말로, 쿠키를 사용하여 사용자를 인증하는 웹 어플리케이션에 유효한 공격 방법이다.\nHTTP Protocol의 C/S Model에 따라 클라이언트는 요청을 하고 서버는 응답하는 프로세스 반복한다. 이때 HTTP 프로토콜은 무상태성과 비연결성이라는 특징을 가지고 있기 때문에 서버는 대개 쿠키를 사용하여 클라이언트를 식별한다.\nCSRF는 이러한 HTTP Protocol의 특징을 악용한다.\n 5hdumat.com라는 커뮤니티 사이트에 인증(로그인)한 사용자가 있다. 해커는 그럴듯한 경로를 만들어 5hdumat-hack.com/thread.do?title=안녕\u0026content=나는해커다라는 링크를 누르게 한다.  피싱 메일이나 XSS 공격 등을 이용   인증받은 사용자가 해커의 그럴듯한 링크를 누른다. 이 때 사용자의 사이트와 다른 도메인으로 HTTP 요청을 보낸다.\n(5hdumat.com - 5hduma-hack.com) 이 요청에는 쿠키가 포함(서드 파티 쿠키)되어 있으므로 공격자가 유도한 동작을 실행할 수 있다.  이 문제를 해결하기 위해선 쿠키 제약조건인 SameSite를 사용해야 한다.\nSameSite SameSite는 서드 파티 쿠키의 보안적인 문제를 해결하기 위해 만들어진 제약조건이다.\n조건으로 None, Lax, Strict 세 가지 종류를 선택할 수 있고, 각각 동작하는 방식이 다르다.\n None: SameSite가 탄생하기 전 쿠키와 동작하는 방식이 같다. None으로 설정된 쿠키의 경우 크로스 사이트 요청의 경우에도 항상 전송된다. 즉 서드 파티 쿠키도 전송된다. 따라서 보안적으로도 SameSite 적용을 하지 않은 쿠키와 마찬가지로 문제가 있는 방식이다. Strict: 가장 보수적인 정책으로 Strict로 설정된 쿠키는 크로스 사이트 요청에는 항상 전송되지 않는다. 즉 서드 파티 쿠키는 전송되지 않고, 퍼스트 파티 쿠키만 전송된다. Lax: Strict에 비해 상대적으로 느슨한 정책이다. 대체로 서드 파티 쿠키는 전송되지 않지만, 몇 가지 예외적인 요청에는 전송 가능하다.  Lax 쿠키가 전송되는 경우 The Chromium Projects 의 SameSite 속성을 소개한 게시물을 보면 다음과 같이 Lax 정책을 설명한다.\n A cookie with “SameSite=Lax” will be sent with a same-site request, or a cross-site top-level navigation with a “safe” HTTP method.\n 즉 같은 웹사이트일 때 이 외에는 Top Level Navigation(웹페이지 이동)과 안전한 HTTP 메서드 요청의 경우 전송된다는 의미이다.\nTop Level navigation에는 유저가 링크()를 클릭하거나, window.location.replace등으로 인해 자동으로 이뤄지는 이동, 302 Redirect와 같은 리소스 경로 변경으로 인한 이동이 포함된다. 하지만 이나 를 문서에 삽입함으로서 발생하는 HTTP 요청은 Top Level navigation이라고 할 수 없으므로 Lax 쿠키가 전송되지 않는다.\n또한 안전하지 않은 POST나 DELETE같은 요청의 경우에도 Lax 쿠키는 전송되지 않는다. 번외로 GET과 같이 서버의 상태를 바꾸지 않을거라고 기대되는 요청에는 Lax 쿠키가 전송된다.\n이 모든 내용은 서드 파티 쿠키에 한하는 것이며, 퍼스트 파티 쿠키는 Lax나 strict여도 전송된다.\n브라우저의 SameSite 구현 Lax by default\n크롬은 SameSite를 가장 적극적으로 적용하고 있는 브라우저이다. 원래 SameSite를 명시하지 않은 쿠키는 기본적으로 None으로 동작했었지만, 2020년 2월 4일 크롬 80 버전이 배포되면서 SameSite의 기본값이 Lax로 변경되었고, 이 변경사항은 운영되고 있는 웹 서비스들에게 많은 영향을 미쳤다. (온라인 결제나 OAuth처럼 구현에 크로스 사이트 간의 페이지 전환이 필요한 경우 이러한 변경사항 때문에 원래 제공하던 기능이 제대로 동작하지 않는다거나)\nSecure 필수 정책\nSameSite 속성으로 None을 사용하려면 반드시 해당 쿠키는 Secure 쿠키 여야 한다. Secure 쿠키는 HTTPS가 적용된 요청에만 전송되는 쿠키인데, 이 정책을 구현하는 브라우저는 현재 크롬밖에 없다. 크롬에서 SameSite=None으로 Set-Cookie를 설정하면 다음과 같이 쿠키 자체가 제대로 설정되지 않는다.\n쿠키의 미래 크로미움 블로그에서는 다음과 같이 장기적으로 서드 파티 쿠키에 대한 지원을 단계적으로 제거할 예정이라고 발표했다.\n … and we have developed the tools to mitigate workarounds, we plan to phase out support for third-party cookies in Chrome.\n 현재로서는 퍼스트 파티 쿠키가 서드 파티 쿠키의 역할을 모두 대체할 수 없는 상황이지만 구글은 이 문제를 해결하기 위해 Frist-Party Sets라는 표준을 제안했다. First-Party Sets는 여러개의 도메인을 동일한 사이트로 다룰 수 있게 만드는 기술인데, 다른 도메인이여도 브라우저에게 “같은 서비스를 제공하고 있다.“라고 알려주면 브라우저는 이후에 서로 다른 도메인을 같은 사이트로 관리할 수 있도록 하는 기술이다. 아직 스펙이 정의되지 않았고 반대도 많은 만큼 어떻게 될 지는 모른한다.\n하지만 점점 더 쿠키를 사용하기 까다로워 질 것이고, 지금부터 서드 파티 쿠키를 최대한 지양하면서 서비스를 개발하는게 좋을 것 같다.\n","wordCount":"750","inLanguage":"en","image":"https://5hdumat.github.io/resources/images/network/cookies.jpg","datePublished":"2021-08-26T22:36:50+09:00","dateModified":"2021-08-26T22:36:50+09:00","author":{"@type":"Person","name":"서민규"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://5hdumat.github.io/posts/network/first-party-cookie-vs-third-party-cookie/"},"publisher":{"@type":"Organization","name":"5hdumat","logo":{"@type":"ImageObject","url":"https://5hdumat.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://5hdumat.github.io accesskey=h title="5hdumat (Alt + H)">5hdumat</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://5hdumat.github.io/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://5hdumat.github.io/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://5hdumat.github.io/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://5hdumat.github.io/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://5hdumat.github.io>Home</a>&nbsp;»&nbsp;<a href=https://5hdumat.github.io/posts/>Posts</a></div>
<h1 class=post-title>
퍼스트 파티 쿠키와 서드 파티 쿠키
</h1>
<div class=post-meta>August 26, 2021&nbsp;·&nbsp;서민규&nbsp;|&nbsp;<a href=https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/ rel="noopener noreferrer" target=_blank>seob.dev</a>
</div>
</header>
<figure class=entry-cover><img loading=lazy src=https://5hdumat.github.io/resources/images/network/cookies.jpg alt>
</figure>
<div class=post-content><h2 id=쿠키에-대한-domain-설정>쿠키에 대한 Domain 설정<a hidden class=anchor aria-hidden=true href=#쿠키에-대한-domain-설정>#</a></h2>
<p>쿠키가 유효한 사이트를 명시하기 위해 쿠키에 도메인을 설정할 수 있다.</p>
<ul>
<li><strong>Set-Cookie:</strong> normal=yes; <strong>Domain</strong>=localhost</li>
</ul>
<p>이렇게 도메인이 명시된 쿠키는 해당 도메인에서만 유효한 쿠키가 된다. 위 예제에서 <code>normal</code> 쿠키는 <code>localhost</code>를 대상으로 쿠키가 설정되었기 때문에, <code>localhost</code>를 대상으로 한 요청에만 <code>normal</code>쿠키가 전송 된다.</p>
<p><strong>쿠키에 별도로 명시된 도메인이 없다면 기본값으로 쿠키를 보낸 서버의 도메인으로 설정된다.</strong></p>
<h2 id=퍼스트-파티-쿠키와-서드-파티-쿠키>퍼스트 파티 쿠키와 서드 파티 쿠키<a hidden class=anchor aria-hidden=true href=#퍼스트-파티-쿠키와-서드-파티-쿠키>#</a></h2>
<p>이렇게 설정된 도메인을 기준으로 <strong>퍼스트 파티 쿠키(First-party cookies)와 서드 파티 쿠키(Third-party cookies)</strong> 로 나눌 수 있다.</p>
<p>아래 예시를 살펴보자.</p>
<ol>
<li>클라이언트가 <code>site1.com</code>에 접속한다.</li>
<li><code>site1.com</code>에 접속한 클라이언트가 <code>image-site.com</code>에서 제공하는 이미지 리소스를 사용하려고 한다.</li>
</ol>
<p>이 경우 클라이언트는 <code>site1.com</code>에 접속해 있지만 <code>image-site.com/image.png</code>로 이미지 리소스에 대한 요청을 보내게 된다. 아래와 같은 HTML 코드로 나타낼 수 있겠다.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>html</span>&gt;
  &lt;<span style=color:#f92672>head</span>&gt;
    &lt;<span style=color:#f92672>title</span>&gt;seob.dev&lt;/<span style=color:#f92672>title</span>&gt;
    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>property</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;og:url&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://site1.com/&#34;</span> /&gt;
  &lt;/<span style=color:#f92672>head</span>&gt;
  &lt;<span style=color:#f92672>body</span>&gt;
    &lt;<span style=color:#f92672>img</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://image-site.com/image.png&#34;</span> /&gt;
  &lt;/<span style=color:#f92672>body</span>&gt;
&lt;/<span style=color:#f92672>html</span>&gt;
</code></pre></div><p>이 때 클라이언트의 쿠키 저장소에 <code>image-site.com</code> 도메인에 대한 쿠키 정보가 조회된다면 브라우저는 요청 헤더에 쿠키 정보를 같이 넘길 것이다. 이렇게 전송되는 쿠키를 <strong>서드 파티 쿠키</strong>라고 한다. 즉, 사용자가 접속한 도메인과 다른 도메인으로 전송하는 쿠키를 의미한다. (<strong>Referer</strong> 헤더와 쿠키에 설정된 도메인이 다른 케이스)</p>
<p>퍼스트 파티 쿠키는 반대로 <strong>클라이언트가 접속한 페이지와 같은 도메인으로 전송되는 쿠키를 의미한다.</strong></p>
<h2 id=쿠키와-csrf>쿠키와 CSRF<a hidden class=anchor aria-hidden=true href=#쿠키와-csrf>#</a></h2>
<p>쿠키의 제약조건 중 보안에서 CSRF를 엄청 간단하게 다뤘지만 좀 더 짚고 넘어가보자.</p>
<h3 id=csrf>CSRF<a hidden class=anchor aria-hidden=true href=#csrf>#</a></h3>
<p>Cross-Stie Request Forgery의 준말로, 쿠키를 사용하여 사용자를 인증하는 웹 어플리케이션에 유효한 공격 방법이다.</p>
<p>HTTP Protocol의 C/S Model에 따라 클라이언트는 요청을 하고 서버는 응답하는 프로세스 반복한다. <strong>이때 HTTP 프로토콜은 무상태성과 비연결성이라는 특징을 가지고 있기 때문에 서버는 대개 쿠키를 사용하여 클라이언트를 식별</strong>한다.</p>
<p><strong>CSRF는 이러한 HTTP Protocol의 특징을 악용한다.</strong></p>
<ol>
<li><code>5hdumat.com</code>라는 커뮤니티 사이트에 인증(로그인)한 사용자가 있다.</li>
<li>해커는 그럴듯한 경로를 만들어 <code>5hdumat-hack.com/thread.do?title=안녕&content=나는해커다</code>라는 링크를 누르게 한다.
<ul>
<li>피싱 메일이나 XSS 공격 등을 이용</li>
</ul>
</li>
<li>인증받은 사용자가 해커의 그럴듯한 링크를 누른다.</li>
<li>이 때 사용자의 사이트와 다른 도메인으로 HTTP 요청을 보낸다.<br>
(<code>5hdumat.com</code> -> <code>5hduma-hack.com</code>)</li>
<li>이 요청에는 쿠키가 포함(서드 파티 쿠키)되어 있으므로 공격자가 유도한 동작을 실행할 수 있다.</li>
</ol>
<p>이 문제를 해결하기 위해선 쿠키 제약조건인 <strong>SameSite</strong>를 사용해야 한다.</p>
<h3 id=samesite>SameSite<a hidden class=anchor aria-hidden=true href=#samesite>#</a></h3>
<p>SameSite는 서드 파티 쿠키의 보안적인 문제를 해결하기 위해 만들어진 제약조건이다.</p>
<p>조건으로 <code>None</code>, <code>Lax</code>, <code>Strict</code> 세 가지 종류를 선택할 수 있고, 각각 동작하는 방식이 다르다.</p>
<ul>
<li><strong>None</strong>: SameSite가 탄생하기 전 쿠키와 동작하는 방식이 같다. None으로 설정된 쿠키의 경우 크로스 사이트 요청의 경우에도 항상 전송된다. 즉 서드 파티 쿠키도 전송된다. 따라서 보안적으로도 SameSite 적용을 하지 않은 쿠키와 마찬가지로 문제가 있는 방식이다.</li>
<li><strong>Strict</strong>: 가장 보수적인 정책으로 Strict로 설정된 쿠키는 크로스 사이트 요청에는 항상 전송되지 않는다. 즉 서드 파티 쿠키는 전송되지 않고, 퍼스트 파티 쿠키만 전송된다.</li>
<li><strong>Lax</strong>: Strict에 비해 상대적으로 느슨한 정책이다. 대체로 서드 파티 쿠키는 전송되지 않지만, 몇 가지 예외적인 요청에는 전송 가능하다.</li>
</ul>
<h3 id=lax-쿠키가-전송되는-경우>Lax 쿠키가 전송되는 경우<a hidden class=anchor aria-hidden=true href=#lax-쿠키가-전송되는-경우>#</a></h3>
<p>The Chromium Projects 의 SameSite 속성을 소개한 게시물을 보면 다음과 같이 Lax 정책을 설명한다.</p>
<blockquote>
<p><strong>A cookie with &ldquo;SameSite=Lax&rdquo; will be sent with a same-site request, or a cross-site top-level navigation with a &ldquo;safe&rdquo; HTTP method.</strong></p>
</blockquote>
<p>즉 같은 웹사이트일 때 이 외에는 <code>Top Level Navigation(웹페이지 이동)</code>과 <code>안전한 HTTP 메서드 요청</code>의 경우 전송된다는 의미이다.</p>
<p>Top Level navigation에는 유저가 링크(<code>&lt;a></code>)를 클릭하거나, <code>window.location.replace</code>등으로 인해 자동으로 이뤄지는 이동, <code>302 Redirect</code>와 같은 리소스 경로 변경으로 인한 이동이 포함된다. 하지만 <code>&lt;iframe></code>이나 <code>&lt;img></code>를 문서에 삽입함으로서 발생하는 HTTP 요청은 Top Level navigation이라고 할 수 없으므로 Lax 쿠키가 전송되지 않는다.</p>
<p>또한 안전하지 않은 <code>POST</code>나 <code>DELETE</code>같은 요청의 경우에도 Lax 쿠키는 전송되지 않는다. 번외로 GET과 같이 서버의 상태를 바꾸지 않을거라고 기대되는 요청에는 Lax 쿠키가 전송된다.</p>
<p>이 모든 내용은 서드 파티 쿠키에 한하는 것이며, 퍼스트 파티 쿠키는 <code>Lax</code>나 <code>strict</code>여도 전송된다.</p>
<h3 id=브라우저의-samesite-구현>브라우저의 SameSite 구현<a hidden class=anchor aria-hidden=true href=#브라우저의-samesite-구현>#</a></h3>
<p><strong>Lax by default</strong></p>
<p>크롬은 <code>SameSite</code>를 가장 적극적으로 적용하고 있는 브라우저이다. 원래 <code>SameSite</code>를 명시하지 않은 쿠키는 기본적으로 <code>None</code>으로 동작했었지만, <strong>2020년 2월 4일 크롬 80 버전이 배포</strong>되면서 <code>SameSite</code>의 기본값이 <code>Lax</code>로 변경되었고, 이 변경사항은 운영되고 있는 웹 서비스들에게 많은 영향을 미쳤다. (온라인 결제나 OAuth처럼 구현에 크로스 사이트 간의 페이지 전환이 필요한 경우 이러한 변경사항 때문에 원래 제공하던 기능이 제대로 동작하지 않는다거나)</p>
<p><strong>Secure 필수 정책</strong></p>
<p><code>SameSite</code> 속성으로 <code>None</code>을 사용하려면 반드시 해당 쿠키는 Secure 쿠키 여야 한다. <code>Secure</code> 쿠키는 HTTPS가 적용된 요청에만 전송되는 쿠키인데, 이 정책을 구현하는 브라우저는 현재 크롬밖에 없다. 크롬에서 <code>SameSite=None</code>으로 <code>Set-Cookie</code>를 설정하면 다음과 같이 쿠키 자체가 제대로 설정되지 않는다.</p>
<h3 id=쿠키의-미래>쿠키의 미래<a hidden class=anchor aria-hidden=true href=#쿠키의-미래>#</a></h3>
<p>크로미움 블로그에서는 다음과 같이 장기적으로 서드 파티 쿠키에 대한 지원을 단계적으로 제거할 예정이라고 발표했다.</p>
<blockquote>
<p><strong>&mldr; and we have developed the tools to mitigate workarounds, we plan to phase out support for third-party cookies in Chrome.</strong></p>
</blockquote>
<p>현재로서는 퍼스트 파티 쿠키가 서드 파티 쿠키의 역할을 모두 대체할 수 없는 상황이지만 구글은 이 문제를 해결하기 위해 <strong>Frist-Party Sets</strong>라는 표준을 제안했다. <strong>First-Party Sets</strong>는 여러개의 도메인을 동일한 사이트로 다룰 수 있게 만드는 기술인데, 다른 도메인이여도 브라우저에게 &ldquo;같은 서비스를 제공하고 있다.&ldquo;라고 알려주면 브라우저는 이후에 서로 다른 도메인을 같은 사이트로 관리할 수 있도록 하는 기술이다. 아직 스펙이 정의되지 않았고 반대도 많은 만큼 어떻게 될 지는 모른한다.</p>
<p>하지만 점점 더 쿠키를 사용하기 까다로워 질 것이고, 지금부터 서드 파티 쿠키를 최대한 지양하면서 서비스를 개발하는게 좋을 것 같다.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://5hdumat.github.io/tags/network/>Network</a></li>
<li><a href=https://5hdumat.github.io/tags/http/>Http</a></li>
<li><a href=https://5hdumat.github.io/tags/cookie/>Cookie</a></li>
<li><a href=https://5hdumat.github.io/tags/samesite/>SameSite</a></li>
<li><a href=https://5hdumat.github.io/tags/csrf/>CSRF</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://5hdumat.github.io/posts/network/http-header-cookie/>
<span class=title>Next Page »</span>
<br>
<span>[HTTP 일반헤더] 쿠키</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on twitter" href="https://twitter.com/intent/tweet/?text=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4&url=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f&hashtags=Network%2cHttp%2cCookie%2cSameSite%2cCSRF"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f&title=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4&summary=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4&source=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f&title=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on whatsapp" href="https://api.whatsapp.com/send?text=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%20-%20https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share 퍼스트 파티 쿠키와 서드 파티 쿠키 on telegram" href="https://telegram.me/share/url?text=%ed%8d%bc%ec%8a%a4%ed%8a%b8%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4%ec%99%80%20%ec%84%9c%eb%93%9c%20%ed%8c%8c%ed%8b%b0%20%ec%bf%a0%ed%82%a4&url=https%3a%2f%2f5hdumat.github.io%2fposts%2fnetwork%2ffirst-party-cookie-vs-third-party-cookie%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a><script src=https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js></script>
<script src=https://utteranc.es/client.js repo=5hdumat/Utterance issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<script></script>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
<footer class=footer>
<span>&copy; 2021 <a href=https://5hdumat.github.io>5hdumat</a></span>
<span>
Powered by
<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer></body>
</html>